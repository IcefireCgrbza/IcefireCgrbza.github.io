---
title: 1.索引与存储引擎
date: 2021-04-21 19:56:39
tags: 九、Mysql
categories: 九、Mysql
---

# B+树

Mysql使用B+树作为索引，采用B+树有以下优势：

+ B+树属于多路查找树，每个索引节点的子节点数量较多，查找性能高
+ B+树节点存储大小适配操作系统页面大小，那么读取数据只需要一次IO，性能高
+ 相对B树，B+树只在叶子节点存储数据，索引节点上只存储Key，可存储叶子节点数更多

一般Mysql的B+树索引只有三层，可存储2000w条数据；千万级别的表，只需要2次IO，三次查找即可。数据大于2000w后，可能导致性能急剧下降

![](https://icefirecgrbza.github.io/img/mysql/b_plus.webp)

我们可以看出，B+树有两大特点，因此索引可用于快速查找和排序

+ 多路查找
+ 叶子节点有序

需要注意以下几点：

+ 若索引字段区分度低，那么索引的效果会很差
+ 索引数量越多，索引的B+树越多，数据插入越慢
+ 优化器会根据索引查询的代价计算是否使用索引，比如过多的in会导致全表扫描
+ 对索引字段进行表达式查询、like查询等不走索引

mysql也有hash类型的索引，但是hash类型的索引容易出现hash冲突，而且不能做范围查询，从存储IO的角度上看并不适合数据库，一般不使用

# 主键索引与非主键索引

+ 主键索引是使用主键作为Key的索引，叶子节点存储指向数据的指针
+ 非主键索引是使用非主键作为Key的索引，叶子节点存储记录的主键，然后再到主键索引上进行查找，这称为回表，这能有效减少存储

![](https://icefirecgrbza.github.io/img/mysql/private_index.webp)

![](https://icefirecgrbza.github.io/img/mysql/index.jpeg)

# 联合索引

采用联合索引时，B+树的Key是联合索引的第一个字段，联合索引的其他字段会用于叶子节点的排序

![](https://icefirecgrbza.github.io/img/mysql/union_index.webp)

联合索引采用最左匹配原则，优先通过前面的字段进行查找

并不是所有使用非主键索引进行的查询都需要回表，若联合索引中存在查询需要的字段，则不会触发回表，这称为覆盖索引

Mysql5.7做了一个优化，使用联合索引进行查询，前面的字段可用索引，后面的字段在联合索引中，采用like查询，不会直接进行回表，而是先进行like过滤再进行回表操作，这称为索引下推

排序不一定会用上联合索引，例如排序的字段并非B+树的Key，而且通过Key定位到了多个值，由联合索引结构可知，在相同值下，联合索引的字段是有序的，排序可以直接使用。若跨多个值，则需要重新排序

# 存储引擎

myisam引擎是5.1版本之前的默认引擎，支持全文检索、压缩、空间函数等，但是不支持事务和行级锁（只支持表级），所以一般用于有大量查询少量插入的场景来使用，而且myisam不支持外键，并且索引和数据是分开存储的

innodb是基于聚簇索引建立的，支持主键自增，和myisam相反它支持事务、外键、行级锁，并且通过MVCC来支持高并发，索引和数据存储在一起